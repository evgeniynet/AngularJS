
<ion-toolbar>
        <button (click)="close()" class="bar-button bar-button-default">
            <span *ngIf="title?.length < 9" primary>Cancel</span>
            <ion-icon *ngIf="title?.length > 9" primary class="invoiceCircle" name="ios-arrow-back"></ion-icon>
        </button>
  <ion-title class="ellipsis padding-right24">{{title}}</ion-title>
</ion-toolbar>
<ion-content class="timelog invoice_create">
    <div class="list max-width700">

 <div class="general-alignment2">     
    
    <select-list *ngIf="!data.number" ajax="true" [list]="selects.user" (onChanged)='saveSelect($event)' preload="true"></select-list>

     <select-list *ngIf="!data.number" [list]="selects.account"  ajax="true" preload="true" (onChanged)='saveSelect($event)'></select-list> 

     <select-list *ngIf="!data.number" [list]="selects.project" preload="true" (onChanged)='saveSelect($event)'></select-list> 

     <!--<select-list *ngIf="!data.number" [list]="selects.ticket" preload="true" (onChanged)='saveSelect($event)'></select-list>-->

     <!--New Contract-->
     <select-list [list]="selects.contract" (onChanged)='saveSelect($event)'></select-list>

     <!--New PrePaid-->
     <select-list [list]="selects.prepaidpack" (onChanged)='saveSelect($event)'></select-list>
     
        </div>
        <!--info -->
        <div *ngIf="selects.contract.selected" class="flatfee">
          <h3 class="text color width35 left table_account text-left">&nbsp;&nbsp;Date Range:</h3>
          <h3 class="width65 left table">{{setDate(invoice_start_date)}} - {{setDate(invoice_end_date)}}</h3>
          <h3 class="text color width35 left table_account text-left">&nbsp;&nbsp;Billing Method:</h3>
          <h3 class="width65 left table">{{contract.billing_method}}</h3>
          <h3 class="text color width35 left table_account text-left">&nbsp;&nbsp;Overage:</h3>
          <h3 class="width65 left table">{{contract.overage}}</h3>
          <h3 *ngIf="contract.flat_fee" class="text color width35 left table_account text-left">&nbsp;&nbsp;Flat Fee:</h3>
          <h3 *ngIf="contract.flat_fee" class="width65 left table">{{contract.flat_fee}}</h3>
        </div>
        <!--end info-->    
 <!--Timelogs-->
 <div style="border-bottom: 1px #fff solid">
   <ion-icon (click)="addTime()" name="add-circle" role="img" class="ion-ios-add-circle item-icon" aria-label="add circle" style="font-size: 2.5em; position: relative; top: 4px; color: #64be42"></ion-icon>
   <h3 style="display: inline-block;">&nbsp;&nbsp;Timelogs</h3>
   <h3 *ngIf="total_hours" style="float: right; width: 20%; text-align: right; text-decoration: underline;">{{total_hours}}hr</h3>
 </div>
 
  <div *ngIf="is_empty" class="table grey2 menu-text">No Timelogs yet</div>
    <ion-list class="list general-alignment2" style="width: 100%" no-lines>
        <a detail-none href=# ion-item *ngFor="let timelog of timelogs" class="margin-top0" style="max-height: 70px;border-bottom: 1px #808080 solid; padding-bottom: 10px; margin-bottom: 10px;">
 <ion-avatar item-left style="width: 17%; margin: 10px 4px 8px 0;">
        <p style="display: inline-flex;">{{timelog.name}}</p>
    </ion-avatar>
            <div class="expenses">
 <li class="text-left left">
     <!--<h3 class="timelogs ellipsis color" [innerHTML]="'<b>' + ((timelog.ticket_number ? ('#'+timelog.ticket_number+': '+timelog.ticket_subject + (timelog.note ? ' - ' : '')) : (timelog.account_name + ': ')) + '</b>' + timelog.note)"></h3>-->
     <h3 class="timelogs ellipsis" *ngIf="timelog.contract_name"><b>Contract:</b> {{timelog.contract_name}}</h3>
     <h3 class="timelogs ellipsis" *ngIf="timelog.prepaid_pack_id > 0"><b>Pre-Paid Pack:</b> {{timelog.prepaid_pack_name}}</h3>
   </li>
      <li class="right margin font-time text-right">
    <span class="expense-hours color" style="text-decoration: underline;">{{getFixed(timelog.hours)}}</span><br>
    <span class="expense-hours color">${{timelog.total}}</span> 
    <h3 class="expense-hours color">{{setDate(timelog.date, timelog.time_offset)}}</h3>  
      </li>
    </div>
  </a>
        </ion-list>
 <!-- End Timelogs-->

 <!-- Exspnses-->
 <div style="border-bottom: 1px #fff solid">
   <ion-icon (click)="addExpense()" name="add-circle" role="img" class="ion-ios-add-circle item-icon" aria-label="add circle" style="font-size: 2.5em; position: relative; top: 4px; color: #64be42"></ion-icon>
   <h3 style="display: inline-block;">&nbsp;&nbsp;Expenses</h3>
   <h3 style="float: right; width: 20%; text-align: right; text-decoration: underline;" *ngIf="exspense_total">${{exspense_total}}</h3>
 </div>
   <div *ngIf="is_empty" class="table grey2 menu-text">No Expenses yet</div>
    <ion-list class="list general-alignment2" style="width: 100%" no-lines>
        <a detail-none href=# ion-item *ngFor="let expense of expenses" class="margin-top0" style="max-height: 70px;border-bottom: 1px #808080 solid; padding-bottom: 9px; margin-bottom: 10px;">
    <ion-avatar item-left style="width: 17%; margin: 10px 4px 8px 0;">
        <p style="display: inline-flex;">{{expense.name}}</p>
    </ion-avatar>
            <div class="expenses">
 <li class="text-left left">
     <h3 class="timelogs ellipsis color" *ngIf="expense.note"><b>Note:&nbsp;{{expense.project_note}}</b></h3>
     <h3 class="timelogs ellipsis" *ngIf="expense.project_id"><b>Project:&nbsp;</b>{{expense.project_name}}</h3>
     <h3 class="timelogs ellipsis" *ngIf="expense.ticket_key"><b>Ticket:&nbsp;</b>{{expense.ticket_name}}</h3>
     </li>
      <li class="right margin font-time text-right">
    <span class="expense-hours color">{{getCurrency(expense.amount)}}</span> 
    <h3 class="expense-hours color">{{setDate(expense.date)}}</h3>  
      </li>
      
    </div>
  </a>
</ion-list>
 <!--End Exspenses -->

 <!--total -->
  <div *ngIf="total_cost" class="total_invoice">
  <h3 style="display: inline-block;">Total Invoice:</h3>
   <h3  style="float: right; width: 35%; text-align: right;">${{total_cost}}</h3>
  </div>
 <!--end total -->

 <!-- Recipients -->
     <div class="sticky">
      <button type="submit" (click)="onSubmit()" secondary class="disable-hover button button-default button-block img-top display">Create & Send</button>
      <div class="stickyborder"></div>
    </div>
 <ion-item padding style="text-align: left; margin-top: -10px;"> 
      <select-list *ngIf="!data.number" ajax="true" [isbutton]=true [list]="selects.recipient_user" (onChanged)='saveSelect($event)' preload="true" style="float: left"></select-list>
    <h2 class="color" style="display: inline-block; font-size: 2.3rem; font-weight: 500; padding-left: 15px; margin-top:7px;">Recipients</h2>
        </ion-item>
    <ion-list class="list resipients_invoice">
    <div *ngIf="!recipients" class="table grey2 menu-text">No recipients yet</div>
        <div *ngFor="let recipient of recipients">
        <div>
      <ion-avatar class="ticketImg left recipient width23">
   <img class="avatarInvoice margin-top10 img_avatar" [alt]="recipient.fullname" [src]="recipient.email | Gravatar"/>
            </ion-avatar></div>
        
        <ion-item class="blue3 width80 invoicelist right margin" no-lines>
      <h3 class="recipient-calc left textLogin margin-top2 ellipsis">{{recipient.email}}</h3>
    <button fab class="red buttonInvoice right topInvoice email-invoice button-fab" (click)="changeContact(recipient)">
      <ion-icon *ngIf="recipient.is_accounting_contact" class="invoiceCircle green" name="checkmark"></ion-icon>
      <ion-icon *ngIf="!recipient.is_accounting_contact" class="invoiceCircle" name="close"></ion-icon>
    </button>
  </ion-item>
        </div>

</ion-list>
 <!-- End Recipients -->

    </div><p style="position: absolute; bottom: 0px;">&nbsp;</p>
</ion-content>